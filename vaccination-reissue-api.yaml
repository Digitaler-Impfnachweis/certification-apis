openapi: 3.0.1
servers:
  - url: https://api.recertify.demo.ubirch.com/
    description: STAGING api server (re-issue only)
  - url: https://api.recertify.ubirch.com/
    description: PRODUCTION api server (re-issue only)
info:
  title: Re-issue Service API
  description: |
    The re-issue service API generates signed
    [Digital Green Certificate (DGC)](https://github.com/ehn-digital-green-development/ehn-dgc-schema/releases/tag/1.0.0)
    conforming certificates with the short validity and based on current regulations. It is mainly used by Apps
    to generate validation certificates.

    ```
    Copyright (C) 2021 IBM Deutschland GmbH
    Copyright (C) 2021 ubirch GmbH

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
    ```

  version: 2.0.0
  license:
    name: 'Apache License, Version 2.0'
    url: 'https://www.apache.org/licenses/LICENSE-2.0'
  contact:
    name: UBIRCH GmbH
    url: https://ubirch.com
    email: mailto:support@ubirch.com
paths:
  # ===========================================================
  # Available API endpoints
  # ===========================================================
  /api/certify/v2/reissue/cbor:
    post:
      tags:
        - Re-issuing
      summary: Re-issue a new certificate based on an existing valid certificate.
      description: |
        # Description

        Re-issue a new certificate based on an existing valid certificate. This operation verifies the authenticity and
        the integrity of the certificate, checks some formal rules of the content of the certificate and re-issues
        a new certificate with a different validity than the original certificate.

        *Applications:* mobile applications, wallet apps
      requestBody:
        description: A valid Digital Green Certificate (DGC) signed in Germany (DE).
        content:
          application/cbor:
            schema:
              $ref: 'vaccination-certify-api.yaml#/components/schemas/CertificateBinary'
          # -- in discussion --
          #application/cbor+base45:
          #  schema:
          #    $ref: '#/components/schemas/CertificateEncoded'
      responses:
        '200':
          description: OK
          content:
            application/cbor+base45:
              schema:
                $ref: 'vaccination-certify-api.yaml#/components/schemas/CertificateEncoded'
            application/cbor:
              schema:
                $ref: 'vaccination-certify-api.yaml#/components/schemas/CertificateBinary'
        '400':
          description: Invalid Request
          # WIP: define extended error messages if input is wrong
        '401':
          description: Authentication Failure (Credential missing)
        '403':
          description: Forbidden (Invalid Credentials)
        '406':
          description: Incorrect CBOR data or invalid signature
        '500':
          description: Internal Server Error
      security:
        - AppBearerToken: [ ]

  /api/certify/v1/reissue/cbor:
    post:
      deprecated: true
      tags:
        - Re-issuing
      summary: Re-issue a new certificate based on an existing valid certificate.
      description: Issues a validation certificate in CBOR/COSE based on the incoming CBOR/COSE Certificate
      requestBody:
        content:
          application/cbor:
            schema:
              $ref: 'vaccination-certify-api.yaml#/components/schemas/CertificateBinary'
      responses:
        '200':
          description: OK
          content:
            application/cbor:
              schema:
                $ref: 'vaccination-certify-api.yaml#/components/schemas/CertificateBinary'
        '400':
          description: Invalid Request
        '401':
          description: Authentication Failure (Credential missing)
        '403':
          description: Forbidden (Invalid Credentials)
        '406':
          description: Incorrect Cbor Data or invalid signature
        '500':
          description: Internal Server Error
      security:
        - AppBearerToken: [ ]
